!function(t){"function"==typeof define&&define.amd?define(["./picker","jquery"],t):"object"==typeof exports?module.exports=t(require("./picker.js"),require("jquery")):t(Picker,jQuery)}(function(t,e){var i,n=t._;function r(t,e){var i,n=this,r=t.$node[0].value,a=t.$node.data("value"),s=a||r,o=a?e.formatSubmit:e.format;n.settings=e,n.$node=t.$node,n.queue={interval:"i",min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"parse create validate",view:"parse create validate",disable:"deactivate",enable:"activate"},n.item={},n.item.clear=null,n.item.interval=e.interval||30,n.item.disable=(e.disable||[]).slice(0),n.item.enable=-(!0===(i=n.item.disable)[0]?i.shift():-1),n.set("min",e.min).set("max",e.max).set("now"),s?n.set("select",s,{format:o}):n.set("select",null).set("highlight",n.item.now),n.key={40:1,38:-1,39:1,37:-1,go:function(t){n.set("highlight",n.item.highlight.pick+t*n.item.interval,{interval:t*n.item.interval}),this.render()}},t.on("render",function(){var i=t.$root.children(),n=i.find("."+e.klass.viewset),r=function(t){return["webkit","moz","ms","o",""].map(function(e){return(e?"-"+e+"-":"")+t})},a=function(t,e){r("transform").map(function(i){t.css(i,e)}),r("transition").map(function(i){t.css(i,e)})};n.length&&(a(i,"none"),i[0].scrollTop=~~n.position().top-2*n[0].clientHeight,a(i,""))},1).on("open",function(){t.$root.find("button").attr("disabled",!1)},1).on("close",function(){t.$root.find("button").attr("disabled",!0)},1)}r.prototype.set=function(t,e,i){var n=this,r=n.item;return null===e?("clear"==t&&(t="select"),r[t]=e,n):(r["enable"==t?"disable":"flip"==t?"enable":t]=n.queue[t].split(" ").map(function(r){return e=n[r](t,e,i)}).pop(),"select"==t?n.set("highlight",r.select,i):"highlight"==t?n.set("view",r.highlight,i):"interval"==t?n.set("min",r.min,i).set("max",r.max,i):t.match(/^(flip|min|max|disable|enable)$/)&&(r.select&&n.disabled(r.select)&&n.set("select",e,i),r.highlight&&n.disabled(r.highlight)&&n.set("highlight",e,i),"min"==t&&n.set("max",r.max,i)),n)},r.prototype.get=function(t){return this.item[t]},r.prototype.create=function(t,i,r){return i=void 0===i?t:i,n.isDate(i)&&(i=[i.getHours(),i.getMinutes()]),e.isPlainObject(i)&&n.isInteger(i.pick)?i=i.pick:e.isArray(i)?i=60*+i[0]+ +i[1]:n.isInteger(i)||(i=this.now(t,i,r)),"max"==t&&i<this.item.min.pick&&(i+=1440),"min"!=t&&"max"!=t&&(i-this.item.min.pick)%this.item.interval!=0&&(i+=this.item.interval),{hour:~~(24+(i=this.normalize(t,i,r))/60)%24,mins:(60+i%60)%60,time:(1440+i)%1440,pick:i%1440}},r.prototype.createRange=function(t,i){var r=this,a=function(t){return!0===t||e.isArray(t)||n.isDate(t)?r.create(t):t};return n.isInteger(t)||(t=a(t)),n.isInteger(i)||(i=a(i)),n.isInteger(t)&&e.isPlainObject(i)?t=[i.hour,i.mins+t*r.settings.interval]:n.isInteger(i)&&e.isPlainObject(t)&&(i=[t.hour,t.mins+i*r.settings.interval]),{from:a(t),to:a(i)}},r.prototype.withinRange=function(t,e){return t=this.createRange(t.from,t.to),e.pick>=t.from.pick&&e.pick<=t.to.pick},r.prototype.overlapRanges=function(t,e){return t=this.createRange(t.from,t.to),e=this.createRange(e.from,e.to),this.withinRange(t,e.from)||this.withinRange(t,e.to)||this.withinRange(e,t.from)||this.withinRange(e,t.to)},r.prototype.now=function(t,e){var i,r=this.item.interval,a=new Date,s=60*a.getHours()+a.getMinutes();return s-=s%r,i=e<0&&r*e+s<=-r,s+="min"==t&&i?0:r,n.isInteger(e)&&(s+=r*(i&&"max"!=t?e+1:e)),s},r.prototype.normalize=function(t,e){var i=this.item.interval,n=this.item.min&&this.item.min.pick||0;return e-="min"==t?0:(e-n)%i},r.prototype.measure=function(t,i,r){return i||(i="min"==t?[0,0]:[23,59]),"string"==typeof i?i=this.parse(t,i):!0===i||n.isInteger(i)?i=this.now(t,i,r):e.isPlainObject(i)&&n.isInteger(i.pick)&&(i=this.normalize(t,i.pick,r)),i},r.prototype.validate=function(t,e,i){var n=i&&i.interval?i.interval:this.item.interval;return this.disabled(e)&&(e=this.shift(e,n)),e=this.scope(e),this.disabled(e)&&(e=this.shift(e,-1*n)),e},r.prototype.disabled=function(t){var i=this,r=i.item.disable.filter(function(r){return n.isInteger(r)?t.hour==r:e.isArray(r)||n.isDate(r)?t.pick==i.create(r).pick:e.isPlainObject(r)?i.withinRange(r,t):void 0});return r=r.length&&!r.filter(function(t){return e.isArray(t)&&"inverted"==t[2]||e.isPlainObject(t)&&t.inverted}).length,-1===i.item.enable?!r:r||t.pick<i.item.min.pick||t.pick>i.item.max.pick},r.prototype.shift=function(t,e){var i=this.item.min.pick,n=this.item.max.pick;for(e=e||this.item.interval;this.disabled(t)&&!((t=this.create(t.pick+=e)).pick<=i||t.pick>=n););return t},r.prototype.scope=function(t){var e=this.item.min.pick,i=this.item.max.pick;return this.create(t.pick>i?i:t.pick<e?e:t)},r.prototype.parse=function(t,e,i){var r,a,s,o,l,c=this,m={};if(!e||"string"!=typeof e)return e;for(o in i&&i.format||((i=i||{}).format=c.settings.format),c.formats.toArray(i.format).map(function(t){var i,r=c.formats[t],a=r?n.trigger(r,c,[e,m]):t.replace(/^!/,"").length;r&&(i=e.substr(0,a),m[t]=i.match(/^\d+$/)?+i:i),e=e.substr(a)}),m)l=m[o],n.isInteger(l)?o.match(/^(h|hh)$/i)?(r=l,"h"!=o&&"hh"!=o||(r%=12)):"i"==o&&(a=l):o.match(/^a$/i)&&l.match(/^p/i)&&("h"in m||"hh"in m)&&(s=!0);return 60*(s?r+12:r)+a},r.prototype.formats={h:function(t,e){return t?n.digits(t):e.hour%12||12},hh:function(t,e){return t?2:n.lead(e.hour%12||12)},H:function(t,e){return t?n.digits(t):""+e.hour%24},HH:function(t,e){return t?n.digits(t):n.lead(e.hour%24)},i:function(t,e){return t?2:n.lead(e.mins)},a:function(t,e){return t?4:720>e.time%1440?"a.m.":"p.m."},A:function(t,e){return t?2:720>e.time%1440?"AM":"PM"},toArray:function(t){return t.split(/(h{1,2}|H{1,2}|i|a|A|!.)/g)},toString:function(t,e){var i=this;return i.formats.toArray(t).map(function(t){return n.trigger(i.formats[t],i,[0,e])||t.replace(/^!/,"")}).join("")}},r.prototype.isTimeExact=function(t,i){return n.isInteger(t)&&n.isInteger(i)||"boolean"==typeof t&&"boolean"==typeof i?t===i:(n.isDate(t)||e.isArray(t))&&(n.isDate(i)||e.isArray(i))?this.create(t).pick===this.create(i).pick:!(!e.isPlainObject(t)||!e.isPlainObject(i))&&(this.isTimeExact(t.from,i.from)&&this.isTimeExact(t.to,i.to))},r.prototype.isTimeOverlap=function(t,i){return n.isInteger(t)&&(n.isDate(i)||e.isArray(i))?t===this.create(i).hour:n.isInteger(i)&&(n.isDate(t)||e.isArray(t))?i===this.create(t).hour:!(!e.isPlainObject(t)||!e.isPlainObject(i))&&this.overlapRanges(t,i)},r.prototype.flipEnable=function(t){var e=this.item;e.enable=t||(-1==e.enable?1:-1)},r.prototype.deactivate=function(t,i){var r=this,a=r.item.disable.slice(0);return"flip"==i?r.flipEnable():!1===i?(r.flipEnable(1),a=[]):!0===i?(r.flipEnable(-1),a=[]):i.map(function(t){for(var i,s=0;s<a.length;s+=1)if(r.isTimeExact(t,a[s])){i=!0;break}i||(n.isInteger(t)||n.isDate(t)||e.isArray(t)||e.isPlainObject(t)&&t.from&&t.to)&&a.push(t)}),a},r.prototype.activate=function(t,i){var r=this,a=r.item.disable,s=a.length;return"flip"==i?r.flipEnable():!0===i?(r.flipEnable(1),a=[]):!1===i?(r.flipEnable(-1),a=[]):i.map(function(t){var i,o,l,c;for(l=0;l<s;l+=1){if(o=a[l],r.isTimeExact(o,t)){i=a[l]=null,c=!0;break}if(r.isTimeOverlap(o,t)){e.isPlainObject(t)?(t.inverted=!0,i=t):e.isArray(t)?(i=t)[2]||i.push("inverted"):n.isDate(t)&&(i=[t.getFullYear(),t.getMonth(),t.getDate(),"inverted"]);break}}if(i)for(l=0;l<s;l+=1)if(r.isTimeExact(a[l],t)){a[l]=null;break}if(c)for(l=0;l<s;l+=1)if(r.isTimeOverlap(a[l],t)){a[l]=null;break}i&&a.push(i)}),a.filter(function(t){return null!=t})},r.prototype.i=function(t,e){return n.isInteger(e)&&e>0?e:this.item.interval},r.prototype.nodes=function(t){var e=this,i=e.settings,r=e.item.select,a=e.item.highlight,s=e.item.view,o=e.item.disable;return n.node("ul",n.group({min:e.item.min.pick,max:e.item.max.pick,i:e.item.interval,node:"li",item:function(t){var l,c=(t=e.create(t)).pick,m=r&&r.pick==c,u=a&&a.pick==c,h=o&&e.disabled(t),p=n.trigger(e.formats.toString,e,[i.format,t]);return[n.trigger(e.formats.toString,e,[n.trigger(i.formatLabel,e,[t])||i.format,t]),(l=[i.klass.listItem],m&&l.push(i.klass.selected),u&&l.push(i.klass.highlighted),s&&s.pick==c&&l.push(i.klass.viewset),h&&l.push(i.klass.disabled),l.join(" ")),"data-pick="+t.pick+" "+n.ariaAttr({role:"option",label:p,selected:!(!m||e.$node.val()!==p)||null,activedescendant:!!u||null,disabled:!!h||null})]}})+n.node("li",n.node("button",i.clear,i.klass.buttonClear,"type=button data-clear=1"+(t?"":" disabled")+" "+n.ariaAttr({controls:e.$node[0].id})),"",n.ariaAttr({role:"presentation"})),i.klass.list,n.ariaAttr({role:"listbox",controls:e.$node[0].id}))},r.defaults={clear:"Clear",format:"h:i A",interval:30,closeOnSelect:!0,closeOnClear:!0,updateInput:!0,klass:{picker:(i=t.klasses().picker)+" "+i+"--time",holder:i+"__holder",list:i+"__list",listItem:i+"__list-item",disabled:i+"__list-item--disabled",selected:i+"__list-item--selected",highlighted:i+"__list-item--highlighted",viewset:i+"__list-item--viewset",now:i+"__list-item--now",buttonClear:i+"__button--clear"}},t.extend("pickatime",r)});
